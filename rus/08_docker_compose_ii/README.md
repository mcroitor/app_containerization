# Особенности настройки кластера контейнеров

- [Особенности настройки кластера контейнеров](#особенности-настройки-кластера-контейнеров)
  - [Аргументы при сборке образа](#аргументы-при-сборке-образа)
  - [Переменные окружения](#переменные-окружения)
  - [Ограничение ресурсов](#ограничение-ресурсов)
  - [Проверка состояния контейнера](#проверка-состояния-контейнера)
  - [Библиография](#библиография)

## Аргументы при сборке образа

Как уже было рассказано при описании Dockerfile, при сборке образа можно передавать аргументы. Это позволяет управлять процессом сборки образа, например, передавать версию приложения или другие параметры. В Docker Compose аргументы можно передавать в файле `docker-compose.yml` с помощью ключа `build.args`. Например, в файле `docker-compose.yml`:

```yaml
version: '3.9'

services:
  web:
    build:
      context: .
      args:
        - APP_VERSION=1.0.0
```

## Переменные окружения

По завершении сборки образа в контейнер можно передать переменные окружения. Это позволяет управлять поведением контейнера, например, передавать параметры подключения к базе данных или другие параметры.

В Docker Compose переменные окружения можно передавать в файле `docker-compose.yml` с помощью ключа `environment`. Например, в файле `docker-compose.yml`:

```yaml
version: '3.9'

services:
  web:
    image: myapp:latest
    environment:
      - DB_HOST=db
      - DB_PORT=5432
```

Также переменные окружения можно передавать в файле `.env`. Например, в файле `.env`:

```env
DB_HOST=db
DB_PORT=5432
```

Тогда в файле `docker-compose.yml` можно использовать переменные окружения:

```yaml
version: '3.9'

services:
  web:
    image: myapp:latest
    environment:
      - DB_HOST=${DB_HOST}
      - DB_PORT=${DB_PORT}
```

Также можно указать файл с переменными окружения в файле `docker-compose.yml` с помощью ключа `env_file`. Например, в файле `docker-compose.yml`:

```yaml
version: '3.9'

services:
  web:
    image: myapp:latest
    env_file:
      - .env
```

Следует помнить, что переменные окружения, переданные в файле `docker-compose.yml`, переопределяют переменные окружения, переданные в файле `.env`.

Кроме того, не рекомендуется хранить в файле `.env` пароли и другие секретные данные. Для хранения секретных данных рекомендуется использовать Docker Secrets или другие инструменты для управления секретами.

## Ограничение ресурсов

Для контейнера можно ограничить доступ к ресурсам хоста. Например, можно ограничить доступ к памяти и CPU. В Docker Compose это можно сделать с помощью ключей `mem_limit` и `cpus`. Например, в файле `docker-compose.yml`:

```yaml
version: '3.9'

services:
  web:
    image: myapp:latest
    mem_limit: 512m
    cpus: 0.5
```

## Проверка состояния контейнера

Также можно проверить состояние контейнера после его запуска. Например, можно проверить, что контейнер успешно запустился и готов к работе. В Docker Compose это можно сделать с помощью ключа `healthcheck`. Например, в файле `docker-compose.yml`:

```yaml
version: '3.9'

services:
  web:
    image: myapp:latest
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost"]
      interval: 30s
      timeout: 10s
      retries: 3
```

## Библиография
